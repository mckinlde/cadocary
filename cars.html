<!DOCTYPE html>
<html lang="en">
  <!-- Apollo Integration -->
<script>function initApollo(){var n=Math.random().toString(36).substring(7),o=document.createElement("script");
o.src="https://assets.apollo.io/micro/website-tracker/tracker.iife.js?nocache="+n,o.async=!0,o.defer=!0,
o.onload=function(){window.trackingFunctions.onLoad({appId:"6929edbe59968d000d772d1d"})},
document.head.appendChild(o)}initApollo();</script>
  <!--  -->
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Cars | Cadocary Software</title>
    <link rel="stylesheet" href="cadocary.css" />
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  </head>
  <body>
    <!-- Header -->
    <header class="header">
      <h1>Cadocary Cars</h1>
      <div class="tagline">
        Visualizing car prices by year.
      </div>
    </header>

    <!-- Main Content -->
    <main>
      <section class="content">
        <h2>Year vs. Price</h2>

        <div class="card">
          <div class="card-graph">
            <canvas id="carsChart"></canvas>
          </div>
          <p id="status" class="status-text">
            Fetching data ...
          </p>
        </div>
      </section>
    </main>

    <!-- Footer -->
    <footer class="footer-simple">
      Â© <span id="year"></span> Cadocary. All rights reserved.
    </footer>

    <script>
      document.getElementById("year").textContent = new Date().getFullYear();

      const apiUrl =
        "https://home-laptop-windows.tailadb589.ts.net/listings?limit=100";

      async function loadCarData() {
        const statusEl = document.getElementById("status");

        try {
          const res = await fetch(apiUrl, {
            method: "GET",
            headers: {
              Accept: "application/json",
            },
          });

          if (!res.ok) {
            throw new Error(`HTTP ${res.status}`);
          }

          const data = await res.json();

          if (!Array.isArray(data) || data.length === 0) {
            statusEl.textContent = "No data returned from server.";
            console.warn("No data:", data);
            return;
          }

          const ctx = document.getElementById("carsChart").getContext("2d");

          new Chart(ctx, {
            type: "scatter",
            data: {
              datasets: [
                {
                  label: "Car Prices",
                  data: data.map((d) => ({
                    x: d.year,
                    y: parseFloat(String(d.price).replace(/[^0-9.-]+/g, "")),
                  })),
                  backgroundColor: "rgba(16, 185, 129, 0.7)",
                  borderColor: "rgba(5, 150, 105, 1)",
                  borderWidth: 1,
                },
              ],
            },
            options: {
              scales: {
                x: {
                  title: {
                    display: true,
                    text: "Year",
                    color: "#e5e7eb",
                    font: { size: 14, weight: "bold" },
                  },
                  ticks: { color: "#d1d5db" },
                },
                y: {
                  title: {
                    display: true,
                    text: "Price (USD)",
                    color: "#e5e7eb",
                    font: { size: 14, weight: "bold" },
                  },
                  ticks: { color: "#d1d5db" },
                },
              },
              plugins: {
                legend: { display: false },
                tooltip: { enabled: true },
              },
              responsive: true,
              maintainAspectRatio: false,
            },
          });

          statusEl.textContent = "Data loaded successfully.";
        } catch (error) {
          statusEl.textContent = "Error loading data ...";
          console.error("Error in loadCarData:", error);
        }
      }

      loadCarData();
    </script>
  </body>
</html>
